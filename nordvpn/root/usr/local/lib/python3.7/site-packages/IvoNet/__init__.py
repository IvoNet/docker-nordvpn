# -*- coding: utf-8; Mode: Python; tab-width: 4 -*-
__doc__ = """IvoNet tools.
  This package will contain my own personal tools.
  I will try to write the stuff in this package with re-use in mind.
  methods I find especially usefull will be made available through this __init__.py
  Otherwise import it from the library...
"""
import os
import zipfile

try:
    from urllib import urlopen
except ImportError:
    from urllib.request import urlopen

__author__ = "Ivo Woltring"
__copyright__ = "Copyright (c) 2019 Ivo Woltring"
__license__ = "Apache 2.0"


def unzip(url, location):
    try:
        from StringIO import StringIO as nio
    except ImportError:
        from io import BytesIO as nio
    fo = zipfile.ZipFile(nio(urlopen(url).read()), 'r')
    fo.extractall(location)
    fo.close()


def url_get(url):
    return urlopen(url).read()


def has_files(foldername):
    return len(os.listdir(foldername)) == 0


def has_ext(foldername, ends_with=".ovpn"):
    try:
        return any(fname.endswith(ends_with) for fname in os.listdir(foldername))
    except FileNotFoundError:
        return False


def environment(key, default):
    try:
        return os.environ[key]
    except KeyError:
        return default


def ovpn_dir():
    return environment("OVPN_DIR", "/ovpn")


def ovpn_tpc_dir():
    return ovpn_dir() + "/ovpn_tcp"


def ovpn_udp_dir():
    return ovpn_dir() + "/ovpn_udp"


def ovpn_url():
    return environment("URL_OVPN_FILES", "https://downloads.nordcdn.com/configs/archives/servers/ovpn.zip")


def api_server_stats():
    return environment("API_SERVER_STATS", "https://nordvpn.com/api/server/stats")


def api_server():
    return environment("API_SERVER", "https://nordvpn.com/api/server")


def create_folder(folder):
    try:
        os.mkdir(folder)
    except OSError:
        pass
